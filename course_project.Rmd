---
title: "Practical Machine Learning - Course Project"
output: html_document
---

```{r}
library(caret)
```

This report is about how to predict the kind of an excersize by analyzing the movement data.

# Load and Prepare the Data

## Load the Data
Download the dataset and load it in memory.
```{r}
pml_training_data <- read.csv("data/pml-training.csv", na.strings=c("NA","#DIV/0!",""), stringsAsFactors = TRUE)
```
## Clean the Data
The first seven rows are removed as they are id columns and data to identify groups of rows.

```{r}
# Remove id columns
trainingData <- pml_training_data[, -c(1:7)]

# remove columns with a variance near zero
nearZeroVarColumns <- nearZeroVar( trainingData )
trainingData <- trainingData[, -nearZeroVarColumns]

# Remove columns which contains more than 97 percent NAs
naColumns <- sapply(trainingData, function(x) mean(is.na(x))) > 0.97
trainingData <- trainingData[, naColumns == FALSE]
```


## Split the data in a training set and a testing set.

```{r}
inTrain <- createDataPartition(y=trainingData$classe, p=0.6, list=FALSE)

training <- trainingData[inTrain,]
testing  <- trainingData[-inTrain,]
```

# Preprocessing

```{r}
preProcValues <- preProcess(training, method = c("center", "scale"))
scaledTrain   <- predict(preProcValues, training)
scaledTesting <- predict(preProcValues, testing)
```

# Fit Model


## CART Model
```{r}
set.seed(9764)
fitControl <- trainControl(method = "cv", number = 3)

rpartFit <- train(classe ~ ., data = scaledTrain, method = "rpart", trControl = fitControl)
rpartFit


predictions <- predict(rpartFit, newdata = scaledTesting)
confusionMatrix(predictions, scaledTesting$classe)
```

## Random Forrest
```{r}
set.seed(9764)
fitControl <- trainControl(method = "cv", number = 3)

rfFit <- train(classe ~ ., data = scaledTrain, method = "rf", trControl = fitControl)
rfFit


predictions <- predict(rfFit, newdata = scaledTesting)
confusionMatrix(predictions, scaledTesting$classe)
```

# ROC-Curve

# Conclusion

# Create Submission

## Perform Data Cleaning
The data must be cleaned in the same way than the training set was cleaned.

```{r}
pml_testing_data  <- read.csv("data/pml-testing.csv", na.strings=c("NA","#DIV/0!",""), stringsAsFactors = TRUE)
# Remove id columns
testingData <- pml_testing_data[, -c(1:7)]
testingData <- testingData[, -nearZeroVarColumns]
testingData <- testingData[, naColumns == FALSE]

scaledTestSubmission   <- predict(preProcValues, testingData)

submissionPredictions <- predict(rfFit, newdata = scaledTestSubmission)
```

## Write submission files
```{r}
 
pml_write_files = function(x){
  n = length(x)
  for(i in 1:n){
    filename = paste0("submission/problem_id_",i,".txt")
    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)
  }
}
pml_write_files(submissionPredictions)
```